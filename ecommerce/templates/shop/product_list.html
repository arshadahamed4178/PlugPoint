{% extends 'shop/base.html' %}

{% block title %}Products - Simple Shop{% endblock %}

{% block content %}
<h1>All Products</h1>

<form method="get" style="margin-bottom: 1rem;">
    <input style="height: 30px;" type="text" name="search" placeholder="Search products..." value="{{ search_query }}">
    <button type="submit">Search</button>
</form>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}"
            style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 15px;">
        {% else %}
        <div
            style="width: 100%; height: 200px; background-color: #f0f0f0; border-radius: 4px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: #888;">
            No Image
        </div>
        {% endif %}
        <h3>{{ product.name }}</h3>
        <p>{{ product.description|truncatewords:15 }}</p>
        <p><strong>â‚¹{{ product.price }}</strong></p>
        <div style="display: flex; gap: 10px; margin-top: auto; padding-top: 15px;">
            {% if user.is_authenticated and product.in_stock %}
            <form action="{% url 'add_to_cart' product.id %}" method="post" style="margin: 0; flex: 1;">
                {% csrf_token %}
                <button type="submit" class="btn" style="width: 100%;">Add to Cart</button>
            </form>
            {% elif not product.in_stock %}
            <button disabled class="btn" style="flex: 1; background-color: #6c757d; cursor: not-allowed;">Out of
                Stock</button>
            {% else %}
            <form action="{% url 'login' %}" method="get" style="margin: 0; flex: 1;">
                <button type="submit" class="btn" style="width: 100%;">Login</button>
            </form>
            {% endif %}

            <form action="{% url 'product_detail' product.id %}" method="get" style="margin: 0; flex: 1;">
                <button type="submit" class="btn" style="width: 100%;">View Details</button>
            </form>
        </div>
    </div>
    {% empty %}
    <p>No products found.</p>
    {% endfor %}
</div>
{% endblock %}